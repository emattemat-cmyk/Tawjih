<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>مرشدك التعليمي</title>
<link rel="stylesheet" href="/static/style.css">
<style>
body { font-family: Arial, sans-serif; background:#f5f5f5; text-align:center; }
h1 { color:#333; margin-top:20px; }
.container { max-width:800px; margin:20px auto; background:white; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
input { width:60px; padding:5px; margin:2px; }
button { padding:10px 20px; margin-top:10px; cursor:pointer; }
.result-box { margin-top:20px; padding:15px; background:#e0ffe0; border-radius:8px; }
.note { color:#555; margin:10px 0; font-size:14px; }
.icon { width:50px; height:50px; margin:5px; }
</style>
</head>
<body>
<div class="container">
<h1>مرشدك التعليمي لاختيار الشعبة</h1>
<p class="note">اختر مستواك ثم أدخل المعدلات الفصلية لكل مادة بدقة ليكون التوجيه دقيقاً.</p>

<div id="level-select">
<button onclick="showForm('middle')">المستوى المتوسط</button>
<button onclick="showForm('secondary')">المستوى الثانوي</button>
</div>

<div id="form-container"></div>
<div class="result-box" id="result-box" style="display:none;"></div>
<p style="margin-top:30px;">المطور: taki aymen imadeddin</p>
</div>

<script>
const MIDDLE_SUBJECTS=["اللغة_العربية","الرياضيات","الفرنسية","الفيزياء","العلوم_الطبيعية"];
const SCIENCE_SUBJECTS=["الرياضيات","الفيزياء","العلوم_الطبيعية"];
const LITERARY_SUBJECTS=["اللغة_العربية","الفرنسية","الانجليزية","الفلسفة"];

let level="", secType="";

function showForm(lv){
    level=lv;
    let html="";
    if(lv=="middle"){
        html="<h3>أدخل المعدلات الفصلية للمواد الأساسية:</h3>";
        MIDDLE_SUBJECTS.forEach(s=>{
            html+=`<div>${s}: 
            <input id="${s}_s1" placeholder="الفصل1">
            <input id="${s}_s2" placeholder="الفصل2">
            <input id="${s}_s3" placeholder="الفصل3">
            </div>`;
        });
        html+=`<button onclick="submitForm()">نتيجة التوجيه</button>`;
    } else {
        html=`<h3>اختر شعبة السنة الأولى ثانوي:</h3>
        <button onclick="setSec('science')">ثانوي علمي</button>
        <button onclick="setSec('literary')">ثانوي أدبي</button>`;
    }
    document.getElementById("form-container").innerHTML=html;
}

function setSec(st){
    secType=st;
    let html="<h3>أدخل المعدلات الفصلية للمواد:</h3>";
    let subjects=st=="science"?SCIENCE_SUBJECTS:LITERARY_SUBJECTS;
    subjects.forEach(s=>{
        html+=`<div>${s}: 
        <input id="${s}_s1" placeholder="الفصل1">
        <input id="${s}_s2" placeholder="الفصل2">
        <input id="${s}_s3" placeholder="الفصل3">
        </div>`;
    });
    html+=`<button onclick="submitForm()">نتيجة التوجيه</button>`;
    document.getElementById("form-container").innerHTML=html;
}

function submitForm(){
    const data={level};
    if(level=="secondary") data.sec_type=secType;
    const subjects=MIDDLE_SUBJECTS.concat(SCIENCE_SUBJECTS).concat(LITERARY_SUBJECTS);
    let valid=true;
    subjects.forEach(s=>{
        ["_s1","_s2","_s3"].forEach(f=>{
            const el=document.getElementById(s+f);
            if(el){
                const val=parseFloat(el.value)||0;
                el.value=val; // تحويل للقيمة الرقمية
                data[s+f]=val;
                if(val<=0) valid=false; // إذا أي خانة فارغة أو صفر
            }
        });
    });
    if(!valid){ alert("يرجى ملء جميع المعدلات الفصلية بدقة"); return;}
    fetch("/analyze/",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(data)
    }).then(res=>res.json()).then(json=>{
        const div=document.getElementById("result-box");
        let html="<h3>الشعبة الملائمة لك:</h3><ul>";
        json.ranking.forEach(r=>{
            if(r.percentage!==null)
                html+=`<li>${r.name}: ${r.percentage}% ملاءمة</li>`;
        });
        html+="</ul><p>"+json.message+"</p>";
        div.innerHTML=html;
        div.style.display="block";
    }).catch(err=>alert("خطأ في الاتصال: "+err));
}
</script>
</body>
</html>
