<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>مرشدك التعليمي</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:tahoma,sans-serif;background:#f0f4f8;margin:0;padding:0}
.container{max-width:900px;margin:20px auto;padding:20px;background:#fff;border-radius:15px;box-shadow:0 5px 15px rgba(0,0,0,0.1)}
h1{text-align:center;color:#333}
button{padding:10px 20px;margin:5px;font-size:16px;cursor:pointer;border:none;border-radius:8px;background:linear-gradient(145deg,#4caf50,#2e7d32);color:#fff;transition:0.3s}
button:hover{transform:translateY(-3px);box-shadow:0 5px 15px rgba(0,0,0,0.2)}
.form-group{margin-bottom:15px}
label{display:block;margin-bottom:5px;font-weight:bold;color:#444}
input{padding:8px;width:100%;border-radius:5px;border:1px solid #ccc;margin-bottom:5px}
.result-box{margin-top:20px;padding:15px;border-radius:10px;background:#e8f5e9;color:#1b5e20;font-weight:bold}
.footer{text-align:center;margin-top:30px;padding:15px;color:#777}
.icon{width:50px;height:50px;display:inline-block;margin-right:10px;vertical-align:middle}
.notice{color:#d32f2f;font-weight:bold;text-align:center;margin-bottom:15px}
</style>
</head>
<body>
<div class="container">
<h1>مرشدك التعليمي لاختيار الشعبة</h1>
<div id="level-selection" style="text-align:center;">
<button onclick="selectLevel('متوسط')">المستوى المتوسط</button>
<button onclick="selectLevel('ثانوي')">المستوى الثانوي</button>
</div>

<div id="form-area"></div>
<div class="result-box" id="result"></div>
<div class="footer">المطور: {{ developer }}</div>
</div>

<script>
const formArea=document.getElementById('form-area');
let selectedLevel='';
let selectedSec='';

function selectLevel(level){selectedLevel=level;renderForm();}
function renderForm(){
    formArea.innerHTML='';
    if(selectedLevel==='متوسط'){renderSubjects(["اللغة العربية","الرياضيات","الفرنسية","الفيزياء","العلوم الطبيعية"]);}
    else if(selectedLevel==='ثانوي'){
        formArea.innerHTML='<p style="text-align:center">اختر شعبة السنة الأولى ثانوي:</p>';
        formArea.innerHTML+='<button onclick="selectSec(\'علمي\')">علمي</button> <button onclick="selectSec(\'أدبي\')">أدبي</button>';
    }
}
function selectSec(sec){selectedSec=sec;if(sec==='علمي') renderSubjects(["الرياضيات","الفيزياء","العلوم الطبيعية"]); else renderSubjects(["اللغة العربية","الفرنسية","الإنجليزية","الفلسفة"]);}
function renderSubjects(subjects){
    let html='<p class="notice">يرجى إدخال المعدل الفصلي لكل مادة بدقة لضمان توجيه دقيق وموثوق لشعبتك المستقبلية.</p>';
    subjects.forEach(s=>{
        html+=`<div class="form-group">
            <label>${s}</label>
            <input type="number" placeholder="الفصل 1" id="${s}_s1">
            <input type="number" placeholder="الفصل 2" id="${s}_s2">
            <input type="number" placeholder="الفصل 3" id="${s}_s3">
        </div>`;
    });
    html+=`<button onclick="submitForm()">احسب الشعبة الملائمة</button>`;
    formArea.innerHTML=html;
}
async function submitForm(){
    const subjectsList=document.querySelectorAll('.form-group');
    const data={level:selectedLevel, sec_type:selectedSec};
    subjectsList.forEach(div=>{
        const label=div.querySelector('label').innerText;
        data[`${label}_s1`]=div.querySelector('#'+label+'_s1').value;
        data[`${label}_s2`]=div.querySelector('#'+label+'_s2').value;
        data[`${label}_s3`]=div.querySelector('#'+label+'_s3').value;
    });
    try{
        const res=await fetch('/analyze/',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});
        const json=await res.json();
        displayResult(json);
    }catch(err){alert('حدث خطأ: '+err);}
}
function displayResult(json){
    let html='';
    if(json.best){
        html+=`<div><img src="/static/icons/${json.best.name}.png" class="icon">${json.best.name} - نسبة الملائمة: ${json.best.match_percent}%</div>`;
    }
    html+='<hr>';
    json.all.forEach(r=>{html+=`<div><img src="/static/icons/${r.name}.png" class="icon">${r.name} - ${r.match_percent}%</div>`;});
    html+=`<p style="margin-top:10px">${json.message}</p>`;
    document.getElementById('result').innerHTML=html;
}
</script>
</body>
</html>
